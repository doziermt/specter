# Specter Recon Tool

**NOTE:**

> Currenlty Tested on KALI 2020.2

Specter Recon Tool is a [KALI Linux](https://www.kali.org/) tool for...

#### Contents

- [Prerequisites](#prerequisites)
- [Getting Started](#getting-started)
- [Configuration](#configuration)
- [Files](#files)
- [Supported Commands](#supported-commands)
- [Specter Work Directory](#specter-work-directory)
- [Developer Guide](#developer-guide)

## Prerequisites

Specter should ideally be run on [KALI Linux](https://www.kali.org/) as the **root user**.
Specter uses the following **required** 3rd-party scanning tools (that come pre-installed on KALI):

- [Nmap](https://nmap.org/) for generating a "clean target list"
- [Masscan](https://github.com/robertdavidgraham/masscan) for performing port scan operations efficiently
- [Eyewitness](https://github.com/FortyNorthSecurity/EyeWitness) for performing a web security scan

If applicable, please follow the links above for information on installing each tool.

## Getting Started

### Installing Specter

This project uses PyPi for package management, and `pip` is required to install the `specter` package.

If you do not have `pip` installed, follow the [installation instructions](https://pip.pypa.io/en/stable/installing/).

Afterward, run:

> pip install -i https://test.pypi.org/simple/ specter

To sanity-check that it has been installed correctly, run:

> specter -h

### Running Specter

1. First, initialize the [Specter Work Directory](#specter-work-directory) by running `specter init`
   This will create a directory called `specter_workdir` *within your current working directory*
2. Open up the `settings.toml` file -- with the editor of your choice -- located at `specter_workdir/settings.toml`
3. Update the following setting options to work with your network configuration:

   * `[general].sitename`
   * `[clean_list].nmap_target_list`
   * `[clean_list].nmap_exclude_list`
   * `[xml_scan].masscan_ip`
   * `[xml_scan].interface`

4. Execute `specter clean_list` to generate the clean target list using `nmap`
5. Execute `specter xml_scan` to perform a port scan using `masscan`
6. Execute `specter web_scan` to perform a web scan using `eyewitness`
7. Execute `specter tree` to see all files in the [Specter Work Directory](#specter-work-directory)

For more information on `specter` commands, reference [Supported Commands](#supported-commands).

## Configuration

Specter uses the [Dynaconf](https://github.com/rochacbruno/dynaconf) Python library for its configuration
parsing and validation library. This project's configuration file uses the
[TOML](https://github.com/toml-lang/toml) markup language.

Within the source code, a sample configuration file lives at path `samples/settings.sample.toml`. This sample configuration
file is copied to the [Specter Work Directory](#specter-work-directory) after running `specter init`.

## Files

After running all Specter commands, the [Specter Work Directory](#specter-work-directory) will contain many different files,
including configuration and output files. The output files include intermediary files generated between operations (e.g.
`output/xml_clean_target_list.txt` and `output/web_clean_target_list.txt`), while others are generated by `masscan` or
`eyewitness` applications.

These files can be visualized by running `specter tree`:

```
specter_workdir/
├── nmap_exclude_list.txt
├── nmap_target_list.txt
├── output/
│   └── test_2020-08-08_10:32:35.413068/
│       ├── hosts/
│       │   ├── 10.0.0.1.txt
│       │   ├── 10.0.0.13.txt
│       │   ├── 10.0.0.2.txt
│       │   ├── 10.0.0.3.txt
│       │   └── 10.0.0.4.txt
│       ├── ports/
│       │   ├── 10001.txt
│       │   ├── 135.txt
│       │   ├── 139.txt
│       │   ├── 20005.txt
│       │   ├── 21.txt
│       │   ├── 445.txt
│       │   ├── 5000.txt
│       │   ├── 53.txt
│       │   ├── 5357.txt
│       │   ├── 548.txt
│       │   ├── 631.txt
│       │   ├── 80.txt
│       │   ├── 8008.txt
│       │   ├── 8009.txt
│       │   ├── 8200.txt
│       │   ├── 8443.txt
│       │   ├── 9000.txt
│       │   └── 9080.txt
│       ├── web_clean_target_list.txt
│       ├── web_reports/
│       │   └── eyewitness/
│       ├── xml/
│       │   └── masscan.xml
│       └── xml_clean_target_list.txt
└── settings.toml
```

**NOTE**:

> Your [Specter Work Directory](#specter-work-directory) will contain different host and IP files dependending on your network configuration.

### Configuration Files

* `settings.toml`: Specter configuration file containing all operational settings.
* `nmap_target_list.txt`: The name of the file containing target list of IPs and IP ranges to scan.
* `nmap_exclude_list.txt`: The name of the file containing the list of excluded IPs that will **NOT** be scanned.

See the [Configuration Section](#configuration) for more information.

### Output Files

* `init`
  * `settings.toml`: Specter configuration file containing all operational settings
  * `nmap_target_list.txt`: The name of the file containing target list of IPs and IP ranges to scan.
  * `nmap_exclude_list.txt`: The name of the file containing the list of excluded IPs that will **NOT** be scanned.

* `clean_list`
  * `output/xml_clean_target_list.txt`: creates a list of IPs or IP ranges for `xml_scan` to scan with excluded IPs removed

* `xml_scan`
  * `output/web_clean_target_list.txt`: creates a list of IPs with ports `80`, `443`, `8000`, `8080`, `8443` open from `masscan.xml`
  * `output/xml/masscan.xml`: `masscan` output file
  * `output/ports/`: `<PORT>`.txt files with lists of IPs with port found open from masscan.xml
  * `output/hosts/`: `<IP>`.txt files with lists of port data found open from masscan.xml

* `web_scan`
  * `ouput/web_reports/Eyewitness`: `eyewitness` output file

## Supported Commands

**TIP**:

> Running `specter --help` will print out a list of all supported commands and usage information.

* `init`: Initializes the [Specter Work Directory](#specter-work-directory). This command should always be exected first.
* `clean_list`: Generates a "clean target list" file, which enumerates the IP addresses to scan using `masscan`.
* `xml_scan`:
  * Scans the IPs from the `xml_clean_target_list.txt` file with `masscan`.
  * Creates `masscan.xml` in `ouput/xml`, `web_clean_target.list.txt` for scanning with `eyewitness`, and `output/hosts` and `output/ports` directory banner data.
* `web_scan`: Scans the "web clean target list" with `eyewitness` and writes the default output to the [Specter Work Directory](#specter-work-directory).
* `tree`: Utility command for visualizing the [Specter Work Directory](#specter-work-directory).

## Specter Work Directory

The Specter Work Directory contains all configuration required by Specter to correctly invoke `nmap`, `masscan`, and
`eyewitness` CLI commands via the Python [subprocess](https://docs.python.org/3/library/subprocess.html) library.
It also contains all intermediary and 3rd-party application output files. "Intermediary" files are those generated by
Specter for feeding "clean target list files" from one application to the subsequent one. The "3rd-party application"
files include those generated by `nmap`, `masscan` and `eyewitness`.

### Snapshotting

Snapshotting of output files allows Specter to retain a history of all output files from previously executed commands.

The Specter Work Directory uses the `[general].sitename` configuration setting along with an auto-generated timestamp to
"snapshot" the output directory. Each time `specter clean_list` is run, a new "snapshot" within the output directory is
created.

**NOTE**:

> **This snapshot is only created for the `clean_list` command.** Running `xml_scan` or `web_scan` will reference the output files
> located within the "snapshot" created by `clean_list`.

For example, running `specter init` followed by `specter clean_list` will generate the following Work Directory structure:

```
specter_workdir/
├── nmap_exclude_list.txt
├── nmap_target_list.txt
├── output/
│   └── test_2020-10-28_11:16:53.937243/
│       ├── hosts/
│       ├── ports/
│       ├── web_reports/
│       │   └── eyewitness/
│       ├── xml/
│       │   └── masscan.xml
│       └── xml_clean_target_list.txt
└── settings.toml
```

In the example above, `test_2020-10-28_11:16:53.937243/` is the "snapshot" generated by the `clean_list` command. When the
`xml_scan` or `web_scan` commands are run, the **same directory snapshot** is used.

To create a new snapsphot, simply re-run `clean_list` which will produce an output structure similar to the following:

```
specter_workdir/
├── nmap_exclude_list.txt
├── nmap_target_list.txt
├── output/
│   ├── test_2020-10-28_11:16:53.937243/
│   │   ├── hosts/
│   │   ├── ports/
│   │   ├── web_reports/
│   │   │   └── eyewitness/
│   │   ├── xml/
│   │   │   └── masscan.xml
│   │   └── xml_clean_target_list.txt
│   └── test_2020-10-28_11:21:48.558567/
│       ├── hosts/
│       ├── ports/
│       ├── web_reports/
│       │   └── eyewitness/
│       ├── xml/
│       └── xml_clean_target_list.txt
└── settings.toml
```

In the example above, 2 "snapshots" can be seen:

* `test_2020-10-28_11:16:53.937243/`
* `test_2020-10-28_11:21:48.558567/`

## Developer Guide

### Dev Environment - Setup

1. Install Python 3: https://www.python.org/downloads/
2. Install `pip`: https://pip.pypa.io/en/stable/installing/
3. Install `tox` using `pip` by running `pip install tox` in your terminal

### Dev Environment - Running Specter CLI

To run any of the [Supported Commands](#supported-commands), first `git clone` and then install the package using `pip|pip3`

```
git clone https://github.com/doziermt/specter
cd specter
[pip|pip3] install -e .
```

Afterward, `specter` can be called directly via the CLI.

Example commands:

* To run `clean_list`:

  > specter clean_list

* To run `xml_scan`:

  > specter xml_scan

* To run `web_scan`:

  > specter web_scan

**TIP**:

> Running `specter --help` or `specter -h` will output help documentation to the CLI.

### Dev Environment - Tools

This project makes use of [tox](https://tox.readthedocs.io/en/latest/) to facilitate testing for developers.

#### Tools for linting

* `tox -e fmt`: Formats the Python project code using the Google linter tool, [yapf](https://github.com/google/yapf)
* `tox -e lint`: Checks that the Python project code passes `yapf` linter checks

#### Tools for package building and publishing

Before executing these tox commands, first install [twine](https://pypi.org/project/twine/) *outside any virtual environment* by executing:

```
[pip|pip3] install twine
```

* `tox -e package-build`: Build the `specter` package distribution for publishing
* `tox -e package-check`: Checks whether the distribution's description conforms to PyPi requirements
* `tox -e package-test-upload`: Validates whether the distribution can successfully be uploaded to [TestPyPi](packaging.python.org/guides/using-testpypi)
* `tox -e package-upload`: Uploads the distribution to [PyPi](https://pypi.org/)
